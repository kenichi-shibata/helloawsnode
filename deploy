#!/bin/bash

case $1 in 

  ami) 
    AWS_PROFILE=test.builder packer build -var-file=infra/vm/variables.json infra/vm/packer.json
    ;;

  network)
    echo 'network'
    cd infra/setup-cloud-network
    terraform init
    terraform plan
    terraform apply
    terraform output -json > network-out.json
    jq -r '.secondary_public_subnet.value' network-out.json > secondary-public-out.file
    jq -r '.primary_public_subnet.value' network-out.json > primary-public-out.file

    mv network-out.json ../..
    mv secondary-public-out.file ../..
    mv primary-public-out.file ../..
    cd ../.. 
    ;;

   application) 
    cd infra/setup-application 
    terraform init
    terraform plan
    terraform apply
    ;;
   *)
            echo $"Usage: $0 {ami|network|application}"
            exit 1
esac
